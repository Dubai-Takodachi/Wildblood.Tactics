@page "/UnitSetup"
@using Wildblood.Tactics.Entities
@using Wildblood.Tactics.Models
@rendermode InteractiveServer

<MudPaper>
    <MudDataGrid T="PlayerSetup" ReadOnly="false" Items="@players" EditMode="DataGridEditMode.Cell" Dense="false">
        <Columns>
            <PropertyColumn Property="p => p.Index + 1" Title="Nr." Sortable="true" InitialDirection="SortDirection.Ascending">
                <EditTemplate Context="player">
                    <MudNumericField T="int" Value="player.Item.Index + 1" ValueChanged="newValue => OnNrChanged(player.Item, newValue)" Immediate="true" />
                </EditTemplate>
            </PropertyColumn>
            <PropertyColumn Property="x => x.Name" Title="Name" Editable="true" />
            <PropertyColumn Property="x => x.Class" Title="Class" Editable="true" >
                <EditTemplate>
                    <MudSelect T="Classes" @bind-Value="context.Item.Class">
                        <MudSelectItem Value="Models.Classes.Longbow">Longbow</MudSelectItem>
                        <MudSelectItem Value="Models.Classes.Shortbow">Short Bow</MudSelectItem>
                        <MudSelectItem Value="Models.Classes.Dualblades">Dual Blades</MudSelectItem>
                        <MudSelectItem Value="Models.Classes.Scimitar">Scimitar</MudSelectItem>
                        <MudSelectItem Value="Models.Classes.Spear">Spear</MudSelectItem>
                        <MudSelectItem Value="Models.Classes.Pike">Pike</MudSelectItem>
                        <MudSelectItem Value="Models.Classes.Nodachi">Nodachi</MudSelectItem>
                        <MudSelectItem Value="Models.Classes.Musket">Musket</MudSelectItem>
                        <MudSelectItem Value="Models.Classes.SpearAndShield">Spear and Shield</MudSelectItem>
                        <MudSelectItem Value="Models.Classes.Maul">Maul</MudSelectItem>
                        <MudSelectItem Value="Models.Classes.LongSword">Long Sword</MudSelectItem>
                        <MudSelectItem Value="Models.Classes.Glaive">Glaive</MudSelectItem>
                        <MudSelectItem Value="Models.Classes.ShortSword">Short Sword</MudSelectItem>
                        <MudSelectItem Value="Models.Classes.Poleaxe">Poleaxe</MudSelectItem>
                    </MudSelect>
                </EditTemplate>
            </PropertyColumn>
            <TemplateColumn Title="Influence">
                <EditTemplate>
                    <MudStack>
                        <MudNumericField Label="Influence" @bind-Value="@context.Item.Influence" Variant="Variant.Text" Min="700" Max="800"/>
                        <MudText>Influence Left: @(context.Item.Influence - @context.Item.Units.Sum(u => u.Influence))</MudText>
                    </MudStack>
                </EditTemplate>
            </TemplateColumn>
            <TemplateColumn Title="First Unit">
                <EditTemplate>
                    <MudPaper>
                        <MudButton Variant="Variant.Filled" @onclick="() => OnButtonChangeClick(0, context.Item)">
                            @if (context.Item.Units.Count >= 1)
                            {
                                <MudText>@context.Item.Units[0].Name</MudText>
                                <img src="ConquerorsBladeData/Units/@context.Item.Units[0].Path" style="width:40px; height:40px;"/>
                            }
                            else
                            {
                                <MudText>No Unit Selected!</MudText>
                            }
                        </MudButton>
                    </MudPaper>
                </EditTemplate>
            </TemplateColumn>
            <TemplateColumn Title="Second Unit">
                <EditTemplate>
                    <MudPaper>
                        <MudButton Variant="Variant.Filled" @onclick="() => OnButtonChangeClick(1, context.Item)">
                            @if (context.Item.Units.Count >= 2)
                            {
                                <MudText>@context.Item.Units[1].Name</MudText>
                                <img src="ConquerorsBladeData/Units/@context.Item.Units[1].Path" style="width:40px; height:40px;" />
                            }
                            else
                            {
                                <MudText>No Unit Selected!</MudText>
                            }
                        </MudButton>
                    </MudPaper>
                </EditTemplate>
            </TemplateColumn>
            <TemplateColumn Title="Third Unit">
                <EditTemplate>
                    <MudPaper>
                        <MudButton Variant="Variant.Filled" @onclick="() => OnButtonChangeClick(2, context.Item)">
                            @if (context.Item.Units.Count >= 3)
                            {
                                <MudText>@context.Item.Units[2].Name</MudText>
                                <img src="ConquerorsBladeData/Units/@context.Item.Units[2].Path" style="width:40px; height:40px;" />
                            }
                            else
                            {
                                <MudText>No Unit Selected!</MudText>
                            }
                        </MudButton>
                    </MudPaper>
                </EditTemplate>
            </TemplateColumn>
            <TemplateColumn Title="Fourth Unit">
                <EditTemplate>
                    <MudPaper>
                        <MudButton Variant="Variant.Filled" @onclick="() => OnButtonChangeClick(3, context.Item)">
                            @if (context.Item.Units.Count >= 4)
                            {
                                <MudText>@context.Item.Units[3].Name</MudText>
                                <img src="ConquerorsBladeData/Units/@context.Item.Units[3].Path" style="width:40px; height:40px;" />
                            }
                            else 
                            {
                                <MudText>No Unit Selected!</MudText>
                            }
                        </MudButton>
                    </MudPaper>
                </EditTemplate>
            </TemplateColumn>
            <TemplateColumn>
                <EditTemplate>
                    <MudButton Variant="Variant.Filled" Color="@Color.Error" @onclick="() => OnDeleteButtonClick(context.Item)">
                        <MudText>Delete</MudText>
                    </MudButton>
                </EditTemplate>
            </TemplateColumn>
        </Columns>
    </MudDataGrid>
    <MudButton ButtonType="ButtonType.Button" Variant=" Variant.Outlined" Color="@Color.Success" OnClick="OnAddButtonClick">
        Add Player
    </MudButton>
</MudPaper>