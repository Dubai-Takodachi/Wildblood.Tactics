@page "/SavedTactics"
@using MongoDB.Driver
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components.Authorization
@using Wildblood.Tactics.Models
@inject IMongoDatabase Database;
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject NavigationManager NavigationManager
@rendermode InteractiveServer

<MudDataGrid Items="Tactics" RowClick="OnRowClicked" T="Tactic">
    <Columns>
        <PropertyColumn Property="item => item.Name" Title="Name" />
        <PropertyColumn Property="item => item.UserId" Title="Creator" />
    </Columns>
</MudDataGrid>


@code {
    // TODO: MAKE IT MORE BEAUTIFUL
    private List<Tactic> Tactics { get; set; } = new List<Tactic>();
    private Tactic selectedTactic;

    protected override async Task OnInitializedAsync() 
    {
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        var user = authState.User.FindFirst(c => c.Type == "sub")?.Value ?? authState.User.FindFirst(c => c.Type == "nameidentifier")?.Value ?? authState.User.Identity.Name;
        Tactics = await Database.GetCollection<Tactic>("Tactics").Find(t => t.UserId == user).ToListAsync();
    }

    private void OnRowClicked(DataGridRowClickEventArgs<Tactic> args)
    {
        NavigationManager.NavigateTo($"/tactics/{args.Item.Id}");
    }


}
